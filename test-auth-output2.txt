
> fastify-auth@1.0.0 test
> cross-env NODE_OPTIONS=--experimental-vm-modules npx jest --detectOpenHandles --forceExit src/tests/unit/services/auth.service.test.js

npm : (node:18204) 
ExperimentalWarning: VM 
Modules is an experimental 
feature and might change at 
any time
At line:1 char:1
+ npm test -- src/tests/unit/se
rvices/auth.service.test.js 
2>&1 | Out-F ...
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~
    + CategoryInfo          :  
   NotSpecified: ((node:18204  
  ) Ex...nge at any time:Str   
 ing) [], RemoteException
    + FullyQualifiedErrorId :  
   NativeCommandError
 
(Use `node --trace-warnings 
...` to show where the warning 
was created)
PASS src/tests/unit/services/au
th.service.test.js
  Auth Service - signup()
    竏・should successfully 
create user with hashed 
password (4 ms)
    竏・should throw 409 error 
when email already exists (2 
ms)
    竏・should hash password 
with bcrypt salt rounds of 10 
(1 ms)
  Auth Service - signin()
    竏・should successfully 
authenticate with valid 
credentials (2 ms)
    竏・should return user 
without password field (2 ms)
    竏・should throw 401 when 
user not found (1 ms)
    竏・should throw 401 when 
password is invalid (1 ms)
  Auth Service - 
createAuthSession()
    竏・should create access and 
refresh tokens (1 ms)
    竏・should store session in 
database (1 ms)
    竏・should set correct token 
expiry (7 days) (2 ms)
  Auth Service - 
refreshAccessToken()
    竏・should return new access 
token with valid refresh token 
(1 ms)
    竏・should throw 401 when 
refresh token is missing (1 ms)
    竏・should throw 401 when 
token type is not refresh (1 
ms)
    竏・should throw 401 when 
session not found in DB (1 ms)
    竏・should throw 401 when 
token signature is invalid (3 
ms)
  Auth Service - signout()
    竏・should delete session 
when refresh token provided (1 
ms)
    竏・should handle missing 
refresh token gracefully (1 ms)

Test Suites: 1 passed, 1 total
Tests:       17 passed, 17 
total
Snapshots:   0 total
Time:        0.285 s
Ran all test suites matching sr
c/tests/unit/services/auth.serv
ice.test.js.
